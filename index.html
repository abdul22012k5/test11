<!DOCTYPE html>
<html>
<head>

<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Automated Sewage Gas Monitoring with Safe Distance Estimation</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Leaflet Map (FREE Industrial Map) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>

body{
margin:0;
font-family:Segoe UI;
background:linear-gradient(135deg,#06202A,#0A3B45);
color:white;
text-align:center;
}

h1{
padding:20px;
margin:0;
}

.container{
display:flex;
flex-wrap:wrap;
justify-content:center;
gap:20px;
padding:20px;
}

.card{
flex:1 1 250px;
padding:25px;
border-radius:15px;
box-shadow:0 10px 20px rgba(0,0,0,0.3);
font-size:22px;
font-weight:bold;
transition:0.3s;
}

.mq7{background:#ff5722;}
.mq2{background:#2196f3;}
.mq3{background:#9c27b0;}

.status-box{
margin-top:20px;
}

.status{
display:inline-block;
padding:15px 40px;
border-radius:30px;
font-size:26px;
font-weight:bold;
transition:0.3s;
}

.safe{
background:#2ecc71;
box-shadow:0 0 20px #2ecc71;
}

.warning{
background:#f39c12;
box-shadow:0 0 20px #f39c12;
}

.danger{
background:#e74c3c;
box-shadow:0 0 20px #e74c3c;
animation:blink 1s infinite;
}

@keyframes blink{
50%{opacity:0.4;}
}

.location-container{
display:flex;
justify-content:center;
gap:20px;
flex-wrap:wrap;
padding:20px;
}

.location-card{
background:#34495e;
padding:20px;
border-radius:12px;
flex:1 1 300px;
}

#map{
width:90%;
height:400px;
margin:20px auto;
border-radius:15px;
box-shadow:0 10px 20px rgba(0,0,0,0.4);
}

@media(max-width:768px){
.card{
flex:1 1 100%;
}
}

</style>

</head>
<body>

<h1>Automated Sewage Gas Monitoring with Safe Distance Estimation</h1>

<div class="container">
  <div id="mq7" class="card mq7">MQ7 (CO)</div>
  <div id="mq2" class="card mq2">MQ2 (Methane, LPG)</div>
  <div id="mq3" class="card mq3">MQ3 (Ammonia)</div>
</div>

<div class="status-box">
  <h2>Status</h2>
  <div id="status" class="status">Loading...</div>
</div>

<div class="location-container">
  <div id="lat" class="location-card"></div>
  <div id="lon" class="location-card"></div>
</div>

<div id="map"></div>

<script>

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyBOYGEHkM5qD0Q2svsG9FZn-9r_RCzE3zk",
  databaseURL: "https://test1-2676c-default-rtdb.asia-southeast1.firebasedatabase.app/"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Initialize Leaflet Map
let map = L.map('map').setView([17.385044, 78.486671], 15);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
}).addTo(map);

let marker = L.marker([17.385044, 78.486671]).addTo(map);

// Firebase Realtime Listener
db.ref("ESP32").on("value",snap=>{

  let d = snap.val();
  if(!d) return;

  document.getElementById("mq7").innerHTML="MQ7 (CO)<br>"+d.MQ7+" PPM";
  document.getElementById("mq2").innerHTML="MQ2 (Methane, LPG)<br>"+d.MQ2+" PPM";
  document.getElementById("mq3").innerHTML="MQ3 (Ammonia)<br>"+d.MQ3+" PPM";

  document.getElementById("lat").innerHTML="Latitude<br>"+d.Latitude;
  document.getElementById("lon").innerHTML="Longitude<br>"+d.Longitude;

  let s=document.getElementById("status");
  s.innerHTML=d.STATUS;
  s.className="status";

  if(d.STATUS=="SAFE") s.classList.add("safe");
  else if(d.STATUS=="WARNING") s.classList.add("warning");
  else s.classList.add("danger");

  // Update Map Location
  let newLat = parseFloat(d.Latitude);
  let newLng = parseFloat(d.Longitude);

  marker.setLatLng([newLat,newLng]);
  map.setView([newLat,newLng],15);

});

</script>

</body>
</html>
