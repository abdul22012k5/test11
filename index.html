<!DOCTYPE html>
<html>
<head>

<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Automated Sewage Gas Monitoring with Safe Distance Estimation</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>

body{
margin:0;
font-family:Segoe UI;
background:#0b1c24;
color:white;
text-align:center;
}

h1{
padding:20px;
margin:0;
background:#122b36;
}

.section{
padding:20px;
}

.container{
display:flex;
flex-wrap:wrap;
justify-content:center;
gap:20px;
}

.card{
flex:1 1 250px;
padding:25px;
border-radius:12px;
font-size:20px;
font-weight:bold;
background:#1c2f38;
box-shadow:0 0 15px rgba(0,0,0,0.6);
}

.mq7{border-left:6px solid #ff5722;}
.mq2{border-left:6px solid #2196f3;}
.mq3{border-left:6px solid #9c27b0;}

.status{
display:inline-block;
padding:12px 35px;
border-radius:25px;
font-size:22px;
font-weight:bold;
}

.safe{background:#2ecc71;}
.warning{background:#f39c12;}
.danger{
background:#e74c3c;
animation:blink 1s infinite;
}

@keyframes blink{
50%{opacity:0.4;}
}

.analysis-container{
display:flex;
flex-wrap:wrap;
justify-content:center;
gap:20px;
padding-top:20px;
}

.analysis-card{
flex:1 1 300px;
background:#16262f;
padding:25px;
border-radius:12px;
font-size:18px;
box-shadow:0 0 15px rgba(0,0,0,0.6);
}

.green{color:#2ecc71;}
.yellow{color:#f1c40f;}
.orange{color:#e67e22;}
.red{color:#e74c3c;}

#map{
width:90%;
height:400px;
margin:30px auto;
border-radius:15px;
}

.location-box{
margin-top:15px;
font-size:18px;
}

@media(max-width:768px){
.container, .analysis-container{
flex-direction:column;
align-items:center;
}
}

</style>
</head>

<body>

<h1>Automated Sewage Gas Monitoring with Safe Distance Estination</h1>

<div class="section">

<div class="container">
  <div id="mq7" class="card mq7">MQ7 (CO)</div>
  <div id="mq2" class="card mq2">MQ2 (Methane, LPG)</div>
  <div id="mq3" class="card mq3">MQ3 (Ammonia)</div>
</div>

<br>

<h2>Status</h2>
<div id="status" class="status">Loading...</div>

<div class="analysis-container">

  <div class="analysis-card">
    <h3>Gas Spread Analysis</h3>
    <div id="spreadStatus">Analyzing...</div>
  </div>

  <div class="analysis-card">
    <h3>Danger Prediction</h3>
    <div id="dangerStatus">Analyzing...</div>
  </div>

</div>

</div>

<div id="map"></div>

<script>

// Firebase Config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  databaseURL: "https://test1-2676c-default-rtdb.asia-southeast1.firebasedatabase.app/"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Leaflet Map
let map = L.map('map').setView([17.385044,78.486671],15);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
maxZoom:19
}).addTo(map);

let marker = L.marker([17.385044,78.486671]).addTo(map);

// Firebase Listener
db.ref("ESP32").on("value",snap=>{

let d = snap.val();
if(!d) return;

document.getElementById("mq7").innerHTML="MQ7 (CO)<br>"+d.MQ7.toFixed(2)+" PPM";
document.getElementById("mq2").innerHTML="MQ2 (Methane, LPG)<br>"+d.MQ2.toFixed(2)+" PPM";
document.getElementById("mq3").innerHTML="MQ3 (Ammonia)<br>"+d.MQ3.toFixed(2)+" PPM";

let s=document.getElementById("status");
s.innerHTML=d.STATUS;
s.className="status";

if(d.STATUS=="SAFE") s.classList.add("safe");
else if(d.STATUS=="WARNING") s.classList.add("warning");
else s.classList.add("danger");

// -------- Spread Logic --------
let spread = d.SpreadRate_PPM_per_sec || 0;
let spreadText="";
let spreadClass="green";

if(spread <= 2){
spreadText="STABLE ENVIRONMENT ("+spread.toFixed(2)+" PPM/sec)";
spreadClass="green";
}
else if(spread <= 8){
spreadText="MODERATE RISE ("+spread.toFixed(2)+" PPM/sec)";
spreadClass="yellow";
}
else{
spreadText="RAPID GAS SPREAD ("+spread.toFixed(2)+" PPM/sec)";
spreadClass="red";
}

document.getElementById("spreadStatus").innerHTML=
"<span class='"+spreadClass+"'>"+spreadText+"</span>";

// -------- Danger Prediction Logic --------
let timeDanger = d.TimeToDanger_sec || 0;
let dangerText="";
let dangerClass="green";

if(timeDanger == 0 && d.STATUS=="SAFE"){
dangerText="NO IMMEDIATE RISK";
dangerClass="green";
}
else if(timeDanger > 60){
dangerText="APPROACHING RISK ("+Math.round(timeDanger)+" sec)";
dangerClass="yellow";
}
else if(timeDanger > 20){
dangerText="HIGH RISK ("+Math.round(timeDanger)+" sec)";
dangerClass="orange";
}
else if(timeDanger > 0){
dangerText="CRITICAL â€“ EVACUATE ("+Math.round(timeDanger)+" sec)";
dangerClass="red";
}
else{
dangerText="STABLE";
dangerClass="green";
}

document.getElementById("dangerStatus").innerHTML=
"<span class='"+dangerClass+"'>"+dangerText+"</span>";

// Update Map
let newLat=parseFloat(d.Latitude);
let newLng=parseFloat(d.Longitude);
marker.setLatLng([newLat,newLng]);
map.setView([newLat,newLng],15);

});

</script>

</body>
</html>
